{"version":3,"file":"Main.controller.js","names":["BaseController","Main","onInit","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","app","firebase","initializeApp","auth","provider","GithubAuthProvider","setCustomParameters","token","getView","setModel","JSONModel","busyOPMLButton","signInToGitHub","githubSignInPopup","createAndDownloadOPMLFile","getModel","setProperty","page","followers","following","octokit","Octokit","resultFollowers","request","data","resultFollowing","length","opml","MessageBox","success","array","outlines","header","Date","i","push","login","type","html_url","headerXML","outlinesXML","outlineXML","text","title","xmlUrl","htmlUrl","xml","downloadFile","signInWithPopup","then","result","credential","accessToken","user","catch","error","errorCode","code","errorMessage","message","email","filename","element","document","createElement","setAttribute","encodeURIComponent","style","display","body","appendChild","click","removeChild"],"sources":["../../src/controller/Main.controller.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-assignment */\nimport BaseController from \"./BaseController\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport MessageBox from \"sap/m/MessageBox\";\n\n/**\n * @namespace de.marianzeis.githubfollower.controller\n */\nexport default class Main extends BaseController {\n  public onInit(): void {\n    const firebaseConfig = {\n\t\tapiKey: \"AIzaSyCy1d13pYC79sOgUZnn4-sJ5VM9QY6TjqM\",\n\t\tauthDomain: \"github-followers-281ea.firebaseapp.com\",\n\t\tprojectId: \"github-followers-281ea\",\n\t\tstorageBucket: \"github-followers-281ea.appspot.com\",\n\t\tmessagingSenderId: \"576057379323\",\n\t\tappId: \"1:576057379323:web:4fb59feea548cdefa1235e\"\n\t};\n\n    // Initialize Firebase\n    this.app = firebase.initializeApp(firebaseConfig);\n\n    // // // Initialize Firebase Authentication and get a reference to the service\n    this.auth = firebase.auth(this.app);\n    this.provider = new firebase.auth.GithubAuthProvider();\n\tthis.provider.setCustomParameters({\n\t\t'allow_signup': 'false'\n\t  });\n\tthis.token = \"\";\n\n\t// create Jsonmodel\n\tthis.getView().setModel(new JSONModel({\n\t\ttoken: \"\",\n\t\tbusyOPMLButton: false\n\t}), \"data\");\n  }\n\n  public signInToGitHub(): void {\n\t\n\tthis.githubSignInPopup(this.provider);\n\t\n  }\n\n  public async createAndDownloadOPMLFile(): Promise<void> {\n\tthis.getModel(\"data\").setProperty(\"/busyOPMLButton\", true);\n\tlet page = 1;\n\tlet followers = []\n\tlet following = []\n\tconst octokit = new Octokit({ auth: this.token });\n\n\tconst resultFollowers = await octokit.request('GET /user/followers')\n\tfollowers = resultFollowers.data\n\tlet resultFollowing = await octokit.request('GET /user/following')\n\tfollowing = resultFollowing.data\n\twhile (resultFollowing.data.length >= 30) {\n\t\tpage += 1\n\t\tresultFollowing = await octokit.request('GET /user/following', {page: page})\n\t\tfollowing = [...following, ...resultFollowing.data]\n\n\t}\n\tthis.opml(following)\n\tthis.getModel(\"data\").setProperty(\"/busyOPMLButton\", false);\n\tMessageBox.success(\"Your OPML file is ready!\");\n  }\n\n  public opml(array): void {\n\tlet outlines = []\n\tvar header = {\n\t\t\"title\": \"title-text\",\n\t\t\"dateCreated\": new Date(2014, 2, 9),\n\t\t\"ownerName\": \"azu\"\n\t};\n\tfor (var i = 0; i < array.length; i++) {\n\t\toutlines.push({\n\t\t\t\"text\": array[i].login,\n\t\t\t\"title\": array[i].login,\n\t\t\ttype: \"rss\",\n\t\t\t\"xmlUrl\": array[i].html_url + \".atom\",\n\t\t\t\"htmlUrl\": array[i].html_url\n\t\t})\n\n\t}\n\tlet headerXML = '<head><title>Sample OPML file for RSSReader</title></head>';\n\tlet outlinesXML = [];\n\tfor (let i = 0; i < outlines.length; i++) {\n\t\tlet outlineXML = '<outline text=\"' + outlines[i].text + '\" title=\"' + outlines[i].title + '\" type=\"' + outlines[i].type + '\" xmlUrl=\"' + outlines[i].xmlUrl + '\" htmlUrl=\"' + outlines[i].htmlUrl + '\" />';\n\t\toutlinesXML.push(outlineXML);\n\t}\n\tlet xml =  '<?xml version=\"1.0\" encoding=\"UTF-8\"?><opml version=\"2.0\">'\n        + headerXML\n\t\t+ '<body>'\n        + outlinesXML\n\t\t+ '</body>'\n        + '</opml>';\n\tthis.downloadFile(\"opml.xml\",xml );\n  }\n  public githubSignInPopup(provider): void {\n\t// [START auth_github_signin_popup]\n\tfirebase\n\t  .auth()\n\t  .signInWithPopup(provider)\n\t  .then((result) => {\n\t\t/** @type {firebase.auth.OAuthCredential} */\n\t\tvar credential = result.credential;\n  \n\t\t// This gives you a GitHub Access Token. You can use it to access the GitHub API.\n\t\tvar token = credential.accessToken;\n\t\tthis.token = token;\n\t\tthis.getModel(\"data\").setProperty(\"/token\", token);\n  \n\t\t// The signed-in user info.\n\t\tvar user = result.user;\n\t\t// ...\n\t  }).catch((error) => {\n\t\t// Handle Errors here.\n\t\tvar errorCode = error.code;\n\t\tvar errorMessage = error.message;\n\t\t// The email of the user's account used.\n\t\tvar email = error.email;\n\t\t// The firebase.auth.AuthCredential type that was used.\n\t\tvar credential = error.credential;\n\t\t// ...\n\t  });\n\t// [END auth_github_signin_popup]\n  }\n\n  public downloadFile(filename, text): void {\n\tvar element = document.createElement('a');\n\telement.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\n\telement.setAttribute('download', filename);\n  \n\telement.style.display = 'none';\n\tdocument.body.appendChild(element);\n  \n\telement.click();\n  \n\tdocument.body.removeChild(element);\n  }\n\n  \n\n}\n"],"mappings":"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"}