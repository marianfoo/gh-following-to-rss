/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","./Element","./RenderManager","sap/ui/performance/trace/Interaction","sap/ui/util/ActivityDetection","sap/ui/events/KeyCodes","sap/base/Log","sap/base/assert","sap/ui/performance/Measurement","sap/ui/events/jquery/EventExtension","sap/ui/events/ControlEvents","sap/ui/events/F6Navigation","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(e,t,o,n,r,i,a,s,d,u,l,f,g){"use strict";u.apply();g(document).on("keydown",function(e){f.handleF6GroupNavigation(e,null)});var p=a.getLogger("sap.ui.Rendering",window["sap-ui-config"]&&(window["sap-ui-config"]["xx-debugRendering"]||window["sap-ui-config"]["xx-debugrendering"])||/sap-ui-xx-debug(R|-r)endering=(true|x|X)/.test(document.location.search)?a.Level.DEBUG:Math.min(a.Level.INFO,a.getLevel())),c=function(e){return e},h=function(){},v=function(){};if(p.isLoggable()){c=function(e){var t;try{throw new Error}catch(e){t=e.stack||e.stacktrace||(e.sourceURL?e.sourceURL+":"+e.line:null);t=t?t.split(/\n\s*/g).slice(2):undefined}return{obj:e,location:t}};h=function(e,t){var o=sap.ui.getCore(),n={},r,i;for(r in t){i=o.byId(r);n[r]={type:i?i.getMetadata().getName():t[r].obj===e?"UIArea":"(no such control)",location:t[r].location,reason:t[r].reason}}p.debug("  UIArea '"+e.getId()+"', pending updates: "+JSON.stringify(n,null,"\t"))};v=function(e,t){var o;for(o in t){if(e[o]!=null){if(e[o].obj!==t[o].obj){t[o].reason="replaced during rendering"}else{t[o].reason="invalidated again during rendering"}}else{t[o].reason="invalidated during rendering"}}}}var y=e.extend("sap.ui.core.UIArea",{constructor:function(t,o){if(arguments.length===0){return}e.apply(this);this.oCore=t;this.bLocked=false;this.bInitial=true;this.aContentToRemove=[];this.bNeedsRerendering=false;if(o!=null){this.setRootNode(o);this.bNeedsRerendering=this.bNeedsRerendering&&!document.getElementById(o.id+"-Init")}this.mInvalidatedControls={};if(!this.bNeedsRerendering){this.bRenderSelf=false}else{this.oCore.addInvalidatedUIArea(this)}},metadata:{publicMethods:["setRootNode","getRootNode","setRootControl","getRootControl","lock","unlock","isLocked"],aggregations:{content:{name:"content",type:"sap.ui.core.Control",multiple:true,singularName:"content"},dependents:{name:"dependents",type:"sap.ui.core.Control",multiple:true}}},insertDependent:function(e,t){return this.insertAggregation("dependents",e,t,true)},addDependent:function(e){return this.addAggregation("dependents",e,true)},removeDependent:function(e){return this.removeAggregation("dependents",e,true)},removeAllDependents:function(){return this.removeAllAggregation("dependents",true)},destroyDependents:function(){return this.destroyAggregation("dependents",true)}});y.prototype.isInvalidateSuppressed=function(){return this.iSuppressInvalidate>0};y.prototype.getId=function(){return this.oRootNode?this.oRootNode.id:null};y.prototype.getUIArea=function(){return this};y.prototype.setRootNode=function(e){if(this.oRootNode===e){return}s(!e||e.nodeType===1&&!g(e).attr("data-sap-ui-area"),"UIArea root node must be a DOMElement");if(this.oRootNode){this._ondetach()}this.oRootNode=e;if(this.getContent().length>0){this.invalidate()}if(this.oRootNode){this._onattach()}};y.prototype.getRootNode=function(){return this.oRootNode};y.prototype.setRootControl=function(e){this.removeAllContent();this.addContent(e)};y.prototype.getRootControl=function(e){var t=this.getContent();if(t.length>0){if(e>=0&&e<t.length){return t[e]}return t[0]}return null};y.prototype._addRemovedContent=function(e){if(this.oRootNode&&e){this.aContentToRemove.push(e)}};y.prototype.addContent=function(e,t){this.addAggregation("content",e,t);if(t!==true){this.invalidate()}return this};y.prototype.removeContent=function(e,t){var o=this.removeAggregation("content",e,t);if(!t){var n;if(o&&o.getDomRef){n=o.getDomRef()}this._addRemovedContent(n)}return o};y.prototype.removeAllContent=function(){var e=this.removeAllAggregation("content");for(var t=0;t<e.length;t++){var o;var n=e[t];if(n&&n.getDomRef){o=n.getDomRef()}this._addRemovedContent(o)}return e};y.prototype.destroyContent=function(){var e=this.getContent();for(var t=0;t<e.length;t++){var o;var n=e[t];if(n&&n.getDomRef){o=n.getDomRef()}this._addRemovedContent(o)}this.destroyAggregation("content");return this};y.prototype.lock=function(){this.bLocked=true};y.prototype.unlock=function(){if(this.bLocked&&this.bNeedsRerendering){this.oCore.addInvalidatedUIArea(this)}this.bLocked=false};y.prototype.isLocked=function(){return this.bLocked};y.prototype.getBindingContext=function(){return null};y.prototype.getEventingParent=function(){return this.oCore._getEventProvider()};y.prototype.isActive=function(){return!!this.getId()&&document.getElementById(this.getId())!=null};y.prototype.invalidate=function(){this.addInvalidatedControl(this)};y.prototype.addInvalidatedControl=function(e){if(this.bRenderSelf){return}if(!this.bNeedsRerendering){this.oCore.addInvalidatedUIArea(this)}var t=e.getId();if(e===this){this.bRenderSelf=true;this.bNeedsRerendering=true;this.mInvalidatedControls={};this.mInvalidatedControls[t]=c(this);return}if(this.mInvalidatedControls[t]){return}if(!this.bRenderSelf){this.mInvalidatedControls[t]=c(e);this.bNeedsRerendering=true}};y.prototype.rerender=function(e){var t=this;function n(){t.bRenderSelf=false;t.aContentToRemove=[];t.mInvalidatedControls={};t.bNeedsRerendering=false}if(e){this.bNeedsRerendering=true}if(this.bLocked||!this.bNeedsRerendering){return false}var r=this.bRenderSelf,i=this.aContentToRemove,s=this.mInvalidatedControls,u=false;n();d.pause("renderPendingUIUpdates");d.start(this.getId()+"---rerender","Rerendering of "+this.getMetadata().getName());h(this,s);if(r){if(this.oRootNode){p.debug("Full Rendering of UIArea '"+this.getId()+"'");o.preserveContent(this.oRootNode,false,this.bInitial);this.bInitial=false;var l=function(e,n){var r=e.length;var i;for(var a=0;a<r;a++){i=n?e[a].getDomRef():e[a];if(i&&!o.isPreservedContent(i)&&t.oRootNode===i.parentNode){g(i).remove()}}return r};var f=document.activeElement;var c=this.oCore.oFocusHandler.getControlFocusInfo();l(i);var y=this.getContent();var m=l(y,true);var C=document.activeElement;for(var R=0;R<m;R++){if(y[R]&&y[R].getParent()===this){this.oCore.oRenderManager.render(y[R],this.oRootNode,true)}}u=true;if(f&&f!=C&&C===document.activeElement){try{this.oCore.oFocusHandler.restoreFocus(c)}catch(e){a.warning("Problems while restoring the focus after full UIArea rendering: "+e,null,this)}}}else{p.debug("Full Rendering of UIArea '"+this.getId()+"' postponed, no root node")}}else{var I=function(e){for(;;){if(e.getMetadata&&e.getMetadata().isInstanceOf("sap.ui.core.PopupInterface")){break}e=e.getParent();if(!e||e===t){return false}if(s.hasOwnProperty(e.getId())){return true}}};for(var b in s){var N=this.oCore.byId(b);if(N&&!I(N)){N.rerender();u=true}}}v(s,this.mInvalidatedControls);d.end(this.getId()+"---rerender");d.resume("renderPendingUIUpdates");return u};y.prototype._onControlRendered=function(e){var t=e.getId();if(this.mInvalidatedControls[t]){delete this.mInvalidatedControls[t]}};y.rerenderControl=function(e){var t=null;if(e){t=e.getDomRef();if(!t||o.isPreservedContent(t)){t=document.getElementById(o.RenderPrefixes.Invisible+e.getId())}}var n=t&&t.parentNode;if(n){var r=e.getUIArea();var i=r?r.oCore.oRenderManager:sap.ui.getCore().createRenderManager();p.debug("Rerender Control '"+e.getId()+"'"+(r?"":" (using a temp. RenderManager)"));o.preserveContent(t,true,false,e);i.render(e,n)}else{var r=e.getUIArea();r&&r._onControlRendered(e);p.warning("Couldn't rerender '"+e.getId()+"', as its DOM location couldn't be determined")}};var m=/^(mousedown|mouseup|click|keydown|keyup|keypress|touchstart|touchend|tap)$/;var C=[],R=[];var I={mousemove:1,mouseover:1,mouseout:1,scroll:1,dragover:1,dragenter:1,dragleave:1};y.addEventPreprocessor=function(e){C.push(e)};y.getEventPreprocessors=function(){return C};y.addEventPostprocessor=function(e){R.push(e)};y.getEventPostprocessors=function(){return R};y.configureEventLogging=function(e){Object.assign(I,e);return Object.assign({},I)};y.prototype._handleEvent=function(e){var o,i,s;o=i=g(e.target).control(0);r.refresh();if(o==null){return}if(e.isMarked("delayedMouseEvent")){return}var d=e.getMark("handledByUIArea"),u=this.getId();if(d&&d!==u){e.setMark("firstUIArea",false);return}e.setMarked("firstUIArea");e.srcControl=o;if(e.type==="contextmenu"&&e.shiftKey&&e.altKey&&(e.metaKey||e.ctrlKey)){a.info("Suppressed forwarding the contextmenu event as control event because CTRL+SHIFT+ALT is pressed!");return}C.forEach(function(t){t(e)});this.oCore._handleControlEvent(e,u);if(this.bLocked||this.oCore.isLocked()){return}if(n.getActive()){s=e.type.match(m);if(s){n.notifyEventStart(e)}}var l=[];if(e.getPseudoTypes){l=e.getPseudoTypes()}l.push(e.type);var f=false;while(i instanceof t&&i.isActive()&&!e.isPropagationStopped()){var p=e.getMark("scopeCheckId"),c=p&&window.document.getElementById(p),h=i.getDomRef();if(!c||h&&h.contains(c)){for(var v=0,y=l.length;v<y;v++){var b=l[v];e.type=b;e.currentTarget=i.getDomRef();i._handleEvent(e);if(e.isImmediatePropagationStopped()){break}}if(!f&&!e.isMarked("enterKeyConsumedAsContent")){f=this._handleGroupChange(e,i)}if(e.isPropagationStopped()){break}if(i.bStopEventBubbling){break}h=i.getDomRef();if(!h){break}}h=h.parentNode;i=null;if(e.isMarked("fromMouseout")&&(h&&h.contains(e.relatedTarget))){break}while(h&&h!==this.getRootNode()){if(h.id){i=g(h).control(0);if(i){break}}h=h.parentNode}}R.forEach(function(t){t(e)});if(s){n.notifyEventEnd(e)}e.currentTarget=this.getRootNode();e.setMark("handledByUIArea",u);if(e.isPropagationStopped()){a.debug("'"+e.type+"' propagation has been stopped")}var N=e.type;if(!I[N]){if(o){a.debug("Event fired: '"+N+"' on "+o,"","sap.ui.core.UIArea")}else{a.debug("Event fired: '"+N+"'","","sap.ui.core.UIArea")}}};y.prototype._onattach=function(){var e=this.getRootNode();if(e==null){return}g(e).attr("data-sap-ui-area",e.id).on(l.events.join(" "),this._handleEvent.bind(this))};y.prototype._ondetach=function(){var e=this.getRootNode();if(e==null){return}g(e).removeAttr("data-sap-ui-area").off()};y.prototype.clone=function(){throw new Error("UIArea can't be cloned")};y.prototype._handleGroupChange=function(e,t){var o=y._oFieldGroupValidationKey;if(e.type==="focusin"||e.type==="focusout"){if(e.type==="focusout"){t=g(document.activeElement).control(0)}if(y._iFieldGroupDelayTimer){clearTimeout(y._iFieldGroupDelayTimer);y._iFieldGroupDelayTimer=null}y._iFieldGroupDelayTimer=setTimeout(this.setFieldGroupControl.bind(this,t),0);return true}else if(this.getFieldGroupControl()&&e.type==="keyup"&&e.keyCode===o.keyCode&&e.shiftKey===o.shiftKey&&e.altKey===o.altKey&&e.ctrlKey===o.ctrlKey){if(y._iFieldGroupTriggerDelay){clearTimeout(y._iFieldGroupTriggerDelay)}var n=this.getFieldGroupControl(),r=n?n._getFieldGroupIds():[];if(r.length>0){n.triggerValidateFieldGroup(r)}return true}return false};y.prototype.setFieldGroupControl=function(e){var o=e;while(o&&!(o instanceof t&&o.isA("sap.ui.core.Control"))){o=o.getParent()}var n=this.getFieldGroupControl();if(o!=n){var r=n?n._getFieldGroupIds():[],i=o?o._getFieldGroupIds():[],a=r.filter(function(e){return i.indexOf(e)<0});if(a.length>0){n.triggerValidateFieldGroup(a)}y._oFieldGroupControl=o}return this};y.prototype.getFieldGroupControl=function(){if(y._oFieldGroupControl&&!y._oFieldGroupControl.bIsDestroyed){return y._oFieldGroupControl}return null};y._oFieldGroupControl=null;y._iFieldGroupDelayTimer=null;y._oFieldGroupValidationKey={keyCode:i.ENTER,shiftKey:false,altKey:false,ctrlKey:false};y._oRenderLog=p;return y});