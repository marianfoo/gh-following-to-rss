/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/format/DateFormat","sap/ui/core/format/NumberFormat","sap/ui/core/Locale","sap/ui/core/LocaleData","sap/base/Log","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/ui/core/date/UniversalDateUtils","sap/ui/unified/calendar/CalendarUtils","./library"],function(t,e,a,r,i,n,o,s,m,u){"use strict";var l=function(){throw new Error};var c=sap.ui.getCore().getLibraryResourceBundle("sap.m");var f={};var T={};var p={DATE:["date"],DATETIME:["datetime"],DATERANGE:["date","date"],DATETIMERANGE:["datetime","datetime"],LASTDAYS:["int"],LASTWEEKS:["int"],LASTMONTHS:["int"],LASTQUARTERS:["int"],LASTYEARS:["int"],NEXTDAYS:["int"],NEXTWEEKS:["int"],NEXTMONTHS:["int"],NEXTQUARTERS:["int"],NEXTYEARS:["int"],FROM:["date"],TO:["date"],FROMDATETIME:["datetime"],TODATETIME:["datetime"],SPECIFICMONTH:["month"],SPECIFICMONTHINYEAR:["month","int"],TODAYFROMTO:["int","int"]};var O=Object.keys(u.StandardDynamicDateRangeKeys);for(var E=0;E<O.length;E++){var F=O[E];var d=c.getText("DYNAMIC_DATE_"+F.toUpperCase()+"_FORMAT");var h=d.split("{").map(function(t){var e=t.indexOf("}");if(e!==-1){return t.slice(e+1)}return t});f[F]=h;var D=[];var v=d.indexOf("{");var A=-1;var g=-1;while(v!==-1){A=d.indexOf("}");g=parseInt(d.slice(v+1,A-A-1));D.push(g);d=d.slice(A+1);v=d.indexOf("{")}T[F]=D}l.getInstance=function(t,e){return this.createInstance(t,e)};l.oDefaultDynamicDateFormat={date:{},datetime:{},month:{pattern:"MMMM"},year:{pattern:"yyyy"},int:{}};l.createInstance=function(i,o){var s=Object.create(this.prototype);if(i instanceof a){o=i;i=undefined}if(!o){o=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale()}s.oLocale=o;s.oLocaleData=r.getInstance(o);s.oOriginalFormatOptions=n({},l.oDefaultDynamicDateFormat,i);s._dateFormatter=t.getInstance(s.oOriginalFormatOptions["date"]);s._dateTimeFormatter=t.getDateTimeInstance(s.oOriginalFormatOptions["datetime"]);[s._dateFormatter].concat(s._dateFormatter.aFallbackFormats).forEach(function(t){t.parseRelative=function(){return null}});[s._dateTimeFormatter].concat(s._dateTimeFormatter.aFallbackFormats).forEach(function(t){t.parseRelative=function(){return null}});s._monthFormatter=t.getInstance(s.oOriginalFormatOptions["month"]);s._yearFormatter=t.getInstance(s.oOriginalFormatOptions["year"]);s._numberFormatter=e.getInstance(s.oOriginalFormatOptions["int"]);s._resourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.m");return s};l.prototype.format=function(t,e){var a=t.operator,r=t.values.slice(0);if(a==="SPECIFICMONTH"){var i=new Date;i.setMonth(r[0]);r[0]=this._monthFormatter.format(i)}else if(a==="SPECIFICMONTHINYEAR"){var i=new Date;i.setMonth(r[0]);i.setYear(r[1]);r[0]=this._monthFormatter.format(i);r[1]=this._yearFormatter.format(i)}else if(a==="LASTDAYS"&&r[0]===1&&!e){a="YESTERDAY";r=[]}else if(a==="NEXTDAYS"&&r[0]===1&&!e){a="TOMORROW";r=[]}else if((a==="LASTDAYS"||a==="NEXTDAYS")&&r[0]===0){a="TODAY";r=[]}else if(a==="DATETIME"){r[0]=this._dateTimeFormatter.format(t.values[0])}else if(a==="TODAYFROMTO"){r[0]=-r[0];if(r[0]>r[1]){r=[r[1],r[0]]}}var n=r.map(function(t){if(t instanceof Date){if(a==="DATETIMERANGE"||a==="FROMDATETIME"||a==="TODATETIME"){return this._dateTimeFormatter.format(t)}return this._dateFormatter.format(t)}if(typeof t==="number"){return this._numberFormatter.format(t)}else{return t.toString()}},this);if(a==="TODAYFROMTO"){n.forEach(function(t,e,a){if(t==="0"){a[e]=(e===0?this.oLocaleData.getNumberSymbol("minusSign"):this.oLocaleData.getNumberSymbol("plusSign"))+t}else{a[e]=r[e]<0?t.toString():this.oLocaleData.getNumberSymbol("plusSign")+t}},this)}return this._resourceBundle.getText("DYNAMIC_DATE_"+a.toUpperCase()+"_FORMAT",n)};l.prototype.parse=function(t,e){var a,r=f[e],i="^"+r.join("(.*)")+"$",n=new RegExp(i,"i"),o=t.match(n);if(o){a={};a.values=[];for(var s=0;s<T[e].length;s++){var u=T[e][s];var l=p[e][u];var c;var O=o[s+1];switch(l){case"date":c=this._dateFormatter.parse(O);break;case"datetime":c=this._dateTimeFormatter.parse(O);break;case"month":var E=[0,1,2,3,4,5,6,7,8,9,10,11].map(function(t){var e=new Date;e.setMonth(t);return this._monthFormatter.format(e)},this);var F=E.indexOf(O);c=F!==-1?F:null;break;case"int":c=this._numberFormatter.parse(O);break;case"string":c=O;break;default:break}if(c&&(l==="date"||l==="datetime")){try{m._checkYearInValidRange(c.getFullYear())}catch(t){c=null}}if(!c&&c!==0){a=null;break}a.values[u]=c}if(e==="TODAYFROMTO"&&a){if(a.values[0]>a.values[1]){a.values=[a.values[1],a.values[0]]}a.values[0]=-a.values[0]}if(a){a.operator=e;return a}}};l.prototype._checkFormatterUTCTimezone=function(t){var e="";if(p[t]){e=p[t]}if(e===""||e[0]==="int"){e="date"}if(this.oOriginalFormatOptions[e]){return this.oOriginalFormatOptions[e].UTC}return false};return l});