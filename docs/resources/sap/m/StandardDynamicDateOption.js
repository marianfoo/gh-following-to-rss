/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/library","sap/ui/core/Element","./DynamicDateOption","./Label","./StepInput","./RadioButton","./RadioButtonGroup","sap/ui/unified/Calendar","sap/ui/unified/calendar/MonthPicker","sap/ui/core/format/DateFormat","sap/ui/core/date/UniversalDateUtils","sap/ui/core/date/UniversalDate","sap/m/DynamicDateValueHelpUIType","./library"],function(e,t,a,s,r,T,n,E,A,R,i,c,S,D){"use strict";var l=e.VerticalAlign;var u=a.extend("sap.m.StandardDynamicDateOption",{metadata:{library:"sap.m"}});var g=1;var o=6e3;var O={DATE:"DATE",DATETIME:"DATETIME",DATERANGE:"DATERANGE",DATETIMERANGE:"DATETIMERANGE",TODAY:"TODAY",YESTERDAY:"YESTERDAY",TOMORROW:"TOMORROW",SPECIFICMONTH:"SPECIFICMONTH",SPECIFICMONTHINYEAR:"SPECIFICMONTHINYEAR",FIRSTDAYWEEK:"FIRSTDAYWEEK",LASTDAYWEEK:"LASTDAYWEEK",FIRSTDAYMONTH:"FIRSTDAYMONTH",LASTDAYMONTH:"LASTDAYMONTH",FIRSTDAYQUARTER:"FIRSTDAYQUARTER",LASTDAYQUARTER:"LASTDAYQUARTER",FIRSTDAYYEAR:"FIRSTDAYYEAR",LASTDAYYEAR:"LASTDAYYEAR",THISWEEK:"THISWEEK",THISMONTH:"THISMONTH",THISQUARTER:"THISQUARTER",THISYEAR:"THISYEAR",LASTWEEK:"LASTWEEK",LASTMONTH:"LASTMONTH",LASTQUARTER:"LASTQUARTER",LASTYEAR:"LASTYEAR",NEXTWEEK:"NEXTWEEK",NEXTMONTH:"NEXTMONTH",NEXTQUARTER:"NEXTQUARTER",NEXTYEAR:"NEXTYEAR",LASTDAYS:"LASTDAYS",LASTWEEKS:"LASTWEEKS",LASTMONTHS:"LASTMONTHS",LASTQUARTERS:"LASTQUARTERS",LASTYEARS:"LASTYEARS",NEXTDAYS:"NEXTDAYS",NEXTWEEKS:"NEXTWEEKS",NEXTMONTHS:"NEXTMONTHS",NEXTQUARTERS:"NEXTQUARTERS",NEXTYEARS:"NEXTYEARS",FROM:"FROM",TO:"TO",FROMDATETIME:"FROMDATETIME",TODATETIME:"TODATETIME",YEARTODATE:"YEARTODATE",DATETOYEAR:"DATETOYEAR",TODAYFROMTO:"TODAYFROMTO",QUARTER1:"QUARTER1",QUARTER2:"QUARTER2",QUARTER3:"QUARTER3",QUARTER4:"QUARTER4"};var Y={SingleDates:1,DateRanges:2,Weeks:3,Months:4,Quarters:5,Years:6};var p={DATE:Y.SingleDates,DATETIME:Y.SingleDates,DATERANGE:Y.DateRanges,DATETIMERANGE:Y.DateRanges,TODAY:Y.SingleDates,YESTERDAY:Y.SingleDates,TOMORROW:Y.SingleDates,SPECIFICMONTH:Y.Months,SPECIFICMONTHINYEAR:Y.Months,FIRSTDAYWEEK:Y.SingleDates,LASTDAYWEEK:Y.SingleDates,FIRSTDAYMONTH:Y.SingleDates,LASTDAYMONTH:Y.SingleDates,FIRSTDAYQUARTER:Y.SingleDates,LASTDAYQUARTER:Y.SingleDates,FIRSTDAYYEAR:Y.SingleDates,LASTDAYYEAR:Y.SingleDates,THISWEEK:Y.Weeks,THISMONTH:Y.Months,THISQUARTER:Y.Quarters,THISYEAR:Y.Years,LASTWEEK:Y.Weeks,LASTMONTH:Y.Months,LASTQUARTER:Y.Quarters,LASTYEAR:Y.Years,NEXTWEEK:Y.Weeks,NEXTMONTH:Y.Months,NEXTQUARTER:Y.Quarters,NEXTYEAR:Y.Years,LASTDAYS:Y.DateRanges,LASTWEEKS:Y.DateRanges,LASTMONTHS:Y.DateRanges,LASTQUARTERS:Y.DateRanges,LASTYEARS:Y.DateRanges,NEXTDAYS:Y.DateRanges,NEXTWEEKS:Y.DateRanges,NEXTMONTHS:Y.DateRanges,NEXTQUARTERS:Y.DateRanges,NEXTYEARS:Y.DateRanges,FROM:Y.DateRanges,TO:Y.DateRanges,FROMDATETIME:Y.DateRanges,TODATETIME:Y.DateRanges,YEARTODATE:Y.DateRanges,DATETOYEAR:Y.DateRanges,TODAYFROMTO:Y.DateRanges,QUARTER1:Y.Quarters,QUARTER2:Y.Quarters,QUARTER3:Y.Quarters,QUARTER4:Y.Quarters};var I=["LASTDAYS","LASTWEEKS","LASTMONTHS","LASTQUARTERS","LASTYEARS"];var M=["NEXTDAYS","NEXTWEEKS","NEXTMONTHS","NEXTQUARTERS","NEXTYEARS"];u.LastXKeys=I;u.NextXKeys=M;var N=sap.ui.getCore().getLibraryResourceBundle("sap.m");u.Keys=O;u.prototype.exit=function(){if(this.aValueHelpUITypes){while(this.aValueHelpUITypes.length){this.aValueHelpUITypes.pop().destroy()}delete this.aValueHelpUITypes}};u.prototype.getText=function(e){var t=this.getKey();var a=e._getOptions();var s=this.getValueHelpUITypes(e);var r=this._getOptionParams(I,a);var T=this._getOptionParams(M,a);if(r){s.push(r)}if(T){s.push(T)}switch(t){case O.LASTDAYS:case O.LASTWEEKS:case O.LASTMONTHS:case O.LASTQUARTERS:case O.LASTYEARS:case O.NEXTDAYS:case O.NEXTWEEKS:case O.NEXTMONTHS:case O.NEXTQUARTERS:case O.NEXTYEARS:return this._getXPeriodTitle(s[1].getOptions());case O.FROMDATETIME:case O.TODATETIME:case O.DATETIMERANGE:return e._findOption(t)._bAdditionalTimeText?N.getText("DYNAMIC_DATE_"+t+"_TITLE")+" ("+N.getText("DYNAMIC_DATE_DATETIME_TITLE")+")":N.getText("DYNAMIC_DATE_"+t+"_TITLE");default:return N.getText("DYNAMIC_DATE_"+t+"_TITLE")}};u.prototype.getValueHelpUITypes=function(e){var t=this.getKey();if(!this.aValueHelpUITypes){switch(t){case O.TODAY:case O.YESTERDAY:case O.TOMORROW:case O.FIRSTDAYWEEK:case O.LASTDAYWEEK:case O.FIRSTDAYMONTH:case O.LASTDAYMONTH:case O.FIRSTDAYQUARTER:case O.LASTDAYQUARTER:case O.FIRSTDAYYEAR:case O.LASTDAYYEAR:case O.THISWEEK:case O.THISMONTH:case O.THISQUARTER:case O.THISYEAR:case O.LASTWEEK:case O.LASTMONTH:case O.LASTQUARTER:case O.LASTYEAR:case O.NEXTWEEK:case O.NEXTMONTH:case O.NEXTQUARTER:case O.NEXTYEAR:case O.YEARTODATE:case O.DATETOYEAR:case O.QUARTER1:case O.QUARTER2:case O.QUARTER3:case O.QUARTER4:this.aValueHelpUITypes=[];break;case O.DATETIME:case O.FROMDATETIME:case O.TODATETIME:this.aValueHelpUITypes=[new S({type:"datetime"})];break;case O.DATE:case O.FROM:case O.TO:this.aValueHelpUITypes=[new S({type:"date"})];break;case O.DATERANGE:this.aValueHelpUITypes=[new S({type:"daterange"})];break;case O.SPECIFICMONTH:this.aValueHelpUITypes=[new S({type:"month"})];break;case O.SPECIFICMONTHINYEAR:this.aValueHelpUITypes=[new S({type:"custommonth"})];break;case O.LASTDAYS:case O.LASTWEEKS:case O.LASTMONTHS:case O.LASTQUARTERS:case O.LASTYEARS:case O.NEXTDAYS:case O.NEXTWEEKS:case O.NEXTMONTHS:case O.NEXTQUARTERS:case O.NEXTYEARS:this.aValueHelpUITypes=[new S({text:N.getText("DDR_LASTNEXTX_LABEL"),type:"int"})];break;case O.TODAYFROMTO:this.aValueHelpUITypes=[new S({text:N.getText("DDR_TODAYFROMTO_FROM_LABEL"),type:"int",additionalText:N.getText("DDR_TODAYFROMTO_TO_ADDITIONAL_LABEL")}),new S({text:N.getText("DDR_TODAYFROMTO_TO_LABEL"),type:"int",additionalText:N.getText("DDR_TODAYFROMTO_TO_ADDITIONAL_LABEL")})];break;case O.DATETIMERANGE:this.aValueHelpUITypes=[new S({text:N.getText("DDR_DATETIMERANGE_FROM_LABEL"),type:"datetime"}),new S({text:N.getText("DDR_DATETIMERANGE_TO_LABEL"),type:"datetime"})];break}}return this.aValueHelpUITypes.slice(0)};u.prototype.createValueHelpUI=function(e,t){var a=e._getOptions(),r=e.getValue()&&Object.assign({},e.getValue()),T=this.getValueHelpUITypes(e),n=[],E;if(!e.aControlsByParameters){e.aControlsByParameters={}}e.aControlsByParameters[this.getKey()]=[];var A=this._getOptionParams(I,a),R=this._getOptionParams(M,a);if(A){T.push(A)}if(R){T.push(R)}if(r&&r.values){r.values=r.values.map(function(t){if(t instanceof Date){return e._reverseConvertDate(t)}return t})}for(var i=0;i<T.length;i++){E=null;if(T[i].getOptions()&&T[i].getOptions().length<=1){break}else if(T[i].getText()){E=new s({text:T[i].getText(),width:"100%"});n.push(E)}var c;switch(T[i].getType()){case"int":c=this._createIntegerControl(r,i,t);if(r&&T[1]&&T[1].getOptions()&&T[1].getOptions().indexOf(r.operator.slice(4).toLowerCase())!==-1){c.setValue(r.values[i])}break;case"date":c=this._createDateControl(r,i,t);break;case"datetime":if(T.length===1){c=this._createDateTimeInnerControl(r,i,t)}else if(T.length===2){c=this._createDateTimeControl(r,i,t)}break;case"daterange":c=this._createDateRangeControl(r,i,t);break;case"month":c=this._createMonthControl(r,i,t);break;case"custommonth":c=this._createCustomMonthControl(r,i,t);break;case"options":c=this._createOptionsControl(r,i,t,T);break;default:break}n.push(c);E&&E.setLabelFor(c);if(T[i].getAdditionalText()){n.push(new s({vAlign:l.Bottom,text:T[i].getAdditionalText()}).addStyleClass("sapMDDRAdditionalLabel"))}e.aControlsByParameters[this.getKey()].push(c)}return n};u.prototype._createIntegerControl=function(e,t,s){var r=a.prototype._createIntegerControl.call(this,e,t,s);var T=this.getKey()==="TODAYFROMTO"?-o:g;var n=!e||this.getKey()!==e.operator;if(n){r.setValue(1)}r.setMin(T);r.setMax(o);return r};u.prototype._createOptionsControl=function(e,t,a,s){var r=new n({buttons:[s[t].getOptions().map(h)]});if(e){var T=s[t].getOptions().indexOf(e.operator.slice(4).toLowerCase());if(T!==-1){r.setSelectedIndex(T)}}if(a instanceof Function){r.attachSelect(function(){a(this)},this)}return r};u.prototype._getOptionParams=function(e,t){if(e.indexOf(this.getKey())!==-1){return new S({text:N.getText("DDR_LASTNEXTX_TIME_PERIODS_LABEL"),type:"options",options:t?t.filter(function(t){return e.indexOf(t.getKey())!==-1}).map(function(e){return e.getKey().slice(4).toLowerCase()}):[]})}return undefined};u.prototype.validateValueHelpUI=function(e){var t=this.getValueHelpUITypes();for(var a=0;a<t.length;a++){var s=e.aControlsByParameters[this.getKey()][a];switch(t[a].getType()){case"int":if(s._isLessThanMin(s.getValue())||s._isMoreThanMax(s.getValue())){return false}break;case"month":case"custommonth":case"date":case"daterange":if(!s.getSelectedDates()||s.getSelectedDates().length==0){return false}break;case"datetime":if(t.length===1){if(!s.getCalendar().getSelectedDates()||s.getCalendar().getSelectedDates().length==0){return false}}else if(!s.getDateValue()&&t.length===2){return false}break;case"options":if(s.getSelectedIndex()<0){return false}break;default:break}}return true};u.prototype.getValueHelpOutput=function(e){var t=e._getOptions();var a=this.getValueHelpUITypes(e),s={},r;if(I.indexOf(this.getKey())!==-1&&e.aControlsByParameters[this.getKey()].length>1){s.operator=t.filter(function(e){return I.indexOf(e.getKey())!==-1})[e.aControlsByParameters[this.getKey()][1].getSelectedIndex()].getKey()}else if(M.indexOf(this.getKey())!==-1&&e.aControlsByParameters[this.getKey()].length>1){s.operator=t.filter(function(e){return M.indexOf(e.getKey())!==-1})[e.aControlsByParameters[this.getKey()][1].getSelectedIndex()].getKey()}else{s.operator=this.getKey()}s.values=[];for(var T=0;T<a.length;T++){var n=e.aControlsByParameters[this.getKey()][T];switch(a[T].getType()){case"int":r=n.getValue();break;case"month":if(!n.getSelectedDates()||!n.getSelectedDates().length){return null}r=n.getSelectedDates()[0].getStartDate().getMonth();break;case"custommonth":if(!n.getSelectedDates()||!n.getSelectedDates().length){return null}r=[n.getSelectedDates()[0].getStartDate().getMonth(),n.getSelectedDates()[0].getStartDate().getFullYear()];break;case"date":if(!n.getSelectedDates().length){return null}r=n.getSelectedDates()[0].getStartDate();break;case"datetime":if(a.length===1){var E,A,R,i;R=n.getCalendar();i=n.getClocks();if(!R.getSelectedDates().length){return null}E=R.getSelectedDates()[0].getStartDate();A=i.getTimeValues();E.setHours(A.getHours(),A.getMinutes(),A.getSeconds());r=E}else if(a.length===2){if(!n.getDateValue()){return null}r=n.getDateValue()}break;case"daterange":if(!n.getSelectedDates().length){return null}var c=n.getSelectedDates()[0].getEndDate()||n.getSelectedDates()[0].getStartDate();r=[n.getSelectedDates()[0].getStartDate(),c];break;default:break}if(Array.isArray(r)){s.values=Array.prototype.concat.apply(s.values,r)}else{r!==null&&r!==undefined&&s.values.push(r)}}return s};u.prototype.getGroup=function(){return p[this.getKey()]};u.prototype.getGroupHeader=function(){return N.getText("DDR_OPTIONS_GROUP_"+p[this.getKey()])};u.prototype.format=function(e,t){return t.format(e,true)};u.prototype.parse=function(e,t){return t.parse(e,this.getKey())};u.prototype.toDates=function(e){if(!e){return null}var t=e.operator;var a=e.values[0]||0;switch(t){case"SPECIFICMONTH":var s=new c;s.setMonth(e.values[0]);s=i.getMonthStartDate(s);return i.getRange(0,"MONTH",s);case"SPECIFICMONTHINYEAR":var s=new c;s.setMonth(e.values[0]);s.setYear(e.values[1]);s=i.getMonthStartDate(s);return i.getRange(0,"MONTH",s);case"DATE":return i.getRange(0,"DAY",c.getInstance(e.values[0]));case"DATETIME":var r=new c.getInstance(e.values[0]);return[r,r];case"DATERANGE":var T=c.getInstance(e.values[0]);var n=c.getInstance(e.values[1]);return[i.resetStartTime(T),i.resetEndTime(n)];case"DATETIMERANGE":var T=c.getInstance(e.values[0]);var n=c.getInstance(e.values[1]);T.setMilliseconds(0);n.setMilliseconds(999);return[T,n];case"TODAY":return i.ranges.today();case"YESTERDAY":return i.ranges.yesterday();case"TOMORROW":return i.ranges.tomorrow();case"FIRSTDAYWEEK":return i.ranges.firstDayOfWeek();case"LASTDAYWEEK":return i.ranges.lastDayOfWeek();case"FIRSTDAYMONTH":return i.ranges.firstDayOfMonth();case"LASTDAYMONTH":return i.ranges.lastDayOfMonth();case"FIRSTDAYQUARTER":return i.ranges.firstDayOfQuarter();case"LASTDAYQUARTER":return i.ranges.lastDayOfQuarter();case"FIRSTDAYYEAR":return i.ranges.firstDayOfYear();case"LASTDAYYEAR":return i.ranges.lastDayOfYear();case"THISWEEK":return i.ranges.currentWeek();case"THISMONTH":return i.ranges.currentMonth();case"THISQUARTER":return i.ranges.currentQuarter();case"THISYEAR":return i.ranges.currentYear();case"LASTWEEK":return i.ranges.lastWeek();case"LASTMONTH":return i.ranges.lastMonth();case"LASTQUARTER":return i.ranges.lastQuarter();case"LASTYEAR":return i.ranges.lastYear();case"NEXTWEEK":return i.ranges.nextWeek();case"NEXTMONTH":return i.ranges.nextMonth();case"NEXTQUARTER":return i.ranges.nextQuarter();case"NEXTYEAR":return i.ranges.nextYear();case"LASTDAYS":return i.ranges.lastDays(a);case"LASTWEEKS":return i.ranges.lastWeeks(a);case"LASTMONTHS":return i.ranges.lastMonths(a);case"LASTQUARTERS":return i.ranges.lastQuarters(a);case"LASTYEARS":return i.ranges.lastYears(a);case"NEXTDAYS":return i.ranges.nextDays(a);case"NEXTWEEKS":return i.ranges.nextWeeks(a);case"NEXTMONTHS":return i.ranges.nextMonths(a);case"NEXTQUARTERS":return i.ranges.nextQuarters(a);case"NEXTYEARS":return i.ranges.nextYears(a);case"FROM":return[c.getInstance(e.values[0])];case"TO":return[c.getInstance(e.values[0])];case"FROMDATETIME":var s=c.getInstance(e.values[0]);s.setMilliseconds(0);return[s];case"TODATETIME":var s=c.getInstance(e.values[0]);s.setMilliseconds(999);return[s];case"YEARTODATE":return i.ranges.yearToDate();case"DATETOYEAR":return i.ranges.dateToYear();case"TODAYFROMTO":if(e.values.length!==2){return[]}var E=e.values[0];var A=e.values[1];var T=E>=0?i.ranges.lastDays(E)[0]:i.ranges.nextDays(-E)[1];var n=A>=0?i.ranges.nextDays(A)[1]:i.ranges.lastDays(-A)[0];if(T.oDate.getTime()>n.oDate.getTime()){n=[T,T=n][0]}return[i.resetStartTime(T),i.resetEndTime(n)];case"QUARTER1":return i.ranges.quarter(1);case"QUARTER2":return i.ranges.quarter(2);case"QUARTER3":return i.ranges.quarter(3);case"QUARTER4":return i.ranges.quarter(4);default:return[]}};u.prototype.enhanceFormattedValue=function(){switch(this.getKey()){case"TODAY":case"YESTERDAY":case"TOMORROW":case"FIRSTDAYWEEK":case"LASTDAYWEEK":case"FIRSTDAYMONTH":case"LASTDAYMONTH":case"FIRSTDAYQUARTER":case"LASTDAYQUARTER":case"FIRSTDAYYEAR":case"LASTDAYYEAR":case"THISWEEK":case"THISMONTH":case"THISQUARTER":case"THISYEAR":case"LASTWEEK":case"LASTMONTH":case"LASTQUARTER":case"LASTYEAR":case"NEXTWEEK":case"NEXTMONTH":case"NEXTQUARTER":case"NEXTYEAR":case"YEARTODATE":case"DATETOYEAR":case"QUARTER1":case"QUARTER2":case"QUARTER3":case"QUARTER4":return true;default:return false}};u.prototype._getXPeriodTitle=function(e){var t,a=this.getKey();if(e.length===1){return N.getText("DYNAMIC_DATE_"+a+"_TITLE")}t=e.map(function(e){return N.getText("DYNAMIC_DATE_"+e.toUpperCase())}).join(" / ");if(a.indexOf("LAST")===0){return N.getText("DYNAMIC_DATE_LASTX_TITLE",t)}if(a.indexOf("NEXT")===0){return N.getText("DYNAMIC_DATE_NEXTX_TITLE",t)}};function h(e){return new T({text:N.getText("DYNAMIC_DATE_"+e.toUpperCase())})}return u});